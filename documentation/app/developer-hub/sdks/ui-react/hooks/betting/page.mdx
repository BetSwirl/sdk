import { Callout } from 'nextra/components';

# Betting Hooks

This page lists all betting-related hooks available in the @betswirl/ui-react library. These hooks handle the complete betting flow from placing bets to receiving results.

<Callout type="info">
  All betting hooks are built on top of Wagmi and require proper provider setup (WagmiProvider, BetSwirlSDKProvider, TokenProvider).
</Callout>

---

## usePlaceBet

⚠️ **Internal Hook** - This is a low-level hook used internally by `useGameLogic`. For most use cases, use `useGameLogic` instead which handles strategy creation and bet placement automatically.

Handles the complete bet placement flow from transaction to result. Manages transaction submission, VRF fee estimation, and result monitoring.

**💡 Tips:** This hook automatically handles VRF fees, transaction status tracking, and result watching. The bet status progresses through: pending → loading → rolling → success.

**Returns:**
- `placeBet: (betAmount: bigint, choice: T) => Promise<void>` - Function to place a bet
- `betStatus: BetStatus` - Current status: 'idle' | 'pending' | 'loading' | 'rolling' | 'success' | 'error' | 'waiting-error' | 'internal-error'
- `isWaiting: boolean` - Whether transaction is being processed
- `isError: unknown` - Error information if bet failed
- `gameResult: GameResult | null` - Result after bet completes (payout, isWin, rolled value)
- `resetBetState: () => void` - Reset hook state for next bet
- `vrfFees: bigint` - VRF fee amount in wei
- `gasPrice: bigint` - Current gas price
- `formattedVrfFees: number` - Human-readable VRF fees
- `wagerWriteHook: ReturnType<typeof useWriteContract>` - Wagmi write contract hook
- `wagerWaitingHook: ReturnType<typeof useWaitForTransactionReceipt>` - Wagmi transaction receipt hook

For typical usage, see the `useGameLogic` hook documentation which provides a complete game implementation.

---

## useBetRequirements

Retrieves betting requirements and restrictions for a specific game and token. Returns whether the token is allowed, maximum bet amount, and maximum bet count.

**💡 Tips:** This hook debounces the grossMultiplier updates by 500ms to reduce unnecessary contract calls. Use maxBetAmount to validate user input before placing bets.

```typescript
import { useBetRequirements } from '@betswirl/ui-react'
import { CASINO_GAME_TYPE } from '@betswirl/sdk-core'

const {
  wagmiHook,
  isAllowed,
  maxBetAmount,
  formattedMaxBetAmount,
  maxBetCount,
  isLoading
} = useBetRequirements({
  game: CASINO_GAME_TYPE.DICE,
  token: selectedToken,
  grossMultiplier: 20000 // 200x in basis points
})

// Validate bet
if (!isAllowed) {
  console.error('Token not allowed for this game')
}

if (betAmount > maxBetAmount) {
  console.error(`Max bet: ${formattedMaxBetAmount} ${token.symbol}`)
}
```

---

## useBetCalculations

Calculates payout amounts and multipliers for a bet. Returns gross/net multipliers, gross/net payouts, and BetSwirl fees. House edge represents the mathematical advantage the casino has over players.

**💡 Tips:** The gross multiplier is the theoretical payout (e.g., 2x for coin toss). The net multiplier is after house edge deduction. Use these values to show expected payouts to users.

```typescript
import { useBetCalculations } from '@betswirl/ui-react'
import { parseEther, formatUnits } from 'viem'

const {
  totalBetAmount,
  grossMultiplier,
  netMultiplier,
  grossPayout,
  netPayout,
  betSwirlFees,
  formattedNetMultiplier
} = useBetCalculations({
  selection: { choice: 'HEADS' },
  betAmount: parseEther('1'),
  betCount: 1,
  gameDefinition,
  token
})

// Display to user
console.log(`Gross multiplier: ${grossMultiplier / 100}x`)
console.log(`Net multiplier: ${formattedNetMultiplier}x`)
console.log(`Potential payout: ${formatUnits(netPayout, token.decimals)}`)
console.log(`House edge fee: ${formatUnits(betSwirlFees, token.decimals)}`)
```

---

## useBetResultWatcher

Watches for bet result events from casino contracts. Uses primary event subscription with automatic fallback to polling if filters fail. Includes timeout protection (3 minutes maximum).

**💡 Tips:** This hook is used internally by usePlaceBet. Use it directly only if you need custom bet result watching logic. It automatically switches to polling fallback if event filters fail.

```typescript
import { useBetResultWatcher } from '@betswirl/ui-react'
import { CASINO_GAME_TYPE } from '@betswirl/sdk-core'

const {
  gameResult,
  status,
  error,
  reset
} = useBetResultWatcher({
  watchParams: {
    contractAddress,
    betId,
    gameType: CASINO_GAME_TYPE.DICE,
    eventAbi,
    eventName: 'Roll',
    betAmount,
    placedBet,
    transactionBlockNumber
  },
  publicClient,
  enabled: true
})

// Monitor status
// Status flow: idle → listening → fallback_listening → success/error/timeout
if (status === 'success') {
  console.log('Bet result:', gameResult)
} else if (status === 'timeout') {
  console.error('Result timeout - check transaction history')
}
```